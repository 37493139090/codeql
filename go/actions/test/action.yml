name: Test Go extractor
description: Run build, QL tests, and optionally basic code sanity checks (formatting and generated code) for the Go extractor
inputs:
  go-test-version:
    description: Which Go version to use for running the tests
    required: false
    default: "~1.23.1"
  run-code-checks:
    description: Whether to run formatting, code and qhelp generation checks
    required: false
    default: false
runs:
  using: composite
  steps:
    - name: Set up Go ${{ inputs.go-test-version }}
      uses: actions/setup-go@v5
      with:
        go-version: ${{ inputs.go-test-version }}

    - name: Build
      shell: bash
      run: |
        declare -px
        where bazel
        bazel version

    - name: Test
      shell: bash
      run: |
        cd go
        make test cache="${{ steps.query-cache.outputs.cache-dir }}"
